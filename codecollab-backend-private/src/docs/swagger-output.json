{
  "openapi": "3.0.0",
  "info": {
    "title": "CodeCollab API",
    "version": "1.0.0",
    "description": "Real-time collaborative coding backend (WebSocket, Docker sandbox execution, Redis presence, and Razorpay-based subscription).",
    "contact": {
      "name": "CodeCollab Dev Team",
      "email": "support@codecollab.io"
    }
  },
  "servers": [
    {
      "url": "http://localhost:4000/api",
      "description": "Local Development"
    },
    {
      "url": "https://api.codecollab.io/api",
      "description": "Production Server"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Use the format: Bearer {token}"
      }
    },
    "schemas": {
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "message": {
            "type": "string",
            "example": "Something went wrong"
          }
        }
      },
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "message": {
            "type": "string",
            "example": "Operation successful"
          },
          "data": {
            "type": "object"
          }
        }
      },
      "AuthRegisterRequest": {
        "type": "object",
        "required": [
          "name",
          "email",
          "password"
        ],
        "properties": {
          "name": {
            "type": "string",
            "example": "Alice"
          },
          "email": {
            "type": "string",
            "format": "email",
            "example": "alice@example.com"
          },
          "password": {
            "type": "string",
            "format": "password",
            "example": "StrongP@ssw0rd"
          }
        }
      },
      "AuthLoginRequest": {
        "type": "object",
        "required": [
          "email",
          "password"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "password": {
            "type": "string",
            "format": "password"
          }
        },
        "example": {
          "email": "alice@example.com",
          "password": "StrongP@ssw0rd"
        }
      },
      "TokenResponse": {
        "type": "object",
        "properties": {
          "accessToken": {
            "type": "string"
          },
          "refreshToken": {
            "type": "string"
          },
          "user": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "email": {
                "type": "string"
              }
            }
          }
        }
      },
      "UserProfile": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "RoomCreate": {
        "type": "object",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 2,
            "maxLength": 50
          },
          "language": {
            "type": "string",
            "default": "javascript"
          },
          "description": {
            "type": "string",
            "nullable": true
          }
        },
        "example": {
          "name": "Team Alpha",
          "language": "typescript",
          "description": "Frontend sprint"
        }
      },
      "Room": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "language": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "ownerId": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "JoinRoomRequest": {
        "type": "object",
        "required": [
          "roomId",
          "userId"
        ],
        "properties": {
          "roomId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          }
        },
        "example": {
          "roomId": "room_123",
          "userId": "user_456"
        }
      },
      "FileCreate": {
        "type": "object",
        "required": [
          "name"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "content": {
            "type": "string"
          },
          "path": {
            "type": "string"
          }
        },
        "example": {
          "name": "index.ts",
          "content": "console.log('hi')",
          "path": "/src"
        }
      },
      "File": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "roomId": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "content": {
            "type": "string"
          },
          "path": {
            "type": "string"
          }
        }
      },
      "SnapshotCreate": {
        "type": "object",
        "required": [
          "code",
          "language"
        ],
        "properties": {
          "code": {
            "type": "string"
          },
          "language": {
            "type": "string"
          },
          "description": {
            "type": "string"
          }
        },
        "example": {
          "code": "print('ok')",
          "language": "python",
          "description": "Working state"
        }
      },
      "ExecutionRequest": {
        "type": "object",
        "required": [
          "code",
          "language"
        ],
        "properties": {
          "code": {
            "type": "string"
          },
          "language": {
            "type": "string",
            "example": "javascript"
          },
          "input": {
            "type": "string"
          },
          "roomId": {
            "type": "string"
          }
        },
        "example": {
          "code": "console.log(1+1)",
          "language": "javascript",
          "input": ""
        }
      },
      "Execution": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "jobId": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "example": "queued"
          },
          "output": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "BillingCreateRequest": {
        "type": "object",
        "required": [
          "planType"
        ],
        "properties": {
          "planType": {
            "type": "string",
            "enum": [
              "FREE",
              "PRO",
              "TEAM"
            ],
            "example": "PRO"
          }
        }
      },
      "BillingVerifyRequest": {
        "type": "object",
        "required": [
          "razorpay_subscription_id",
          "razorpay_payment_id",
          "razorpay_signature"
        ],
        "properties": {
          "razorpay_subscription_id": {
            "type": "string"
          },
          "razorpay_payment_id": {
            "type": "string"
          },
          "razorpay_signature": {
            "type": "string"
          }
        }
      },
      "Subscription": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "plan": {
            "type": "string"
          },
          "status": {
            "type": "string"
          },
          "currentPeriodEnd": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "Notification": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "isRead": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "RazorpayWebhookHeaders": {
        "type": "object",
        "properties": {
          "x-razorpay-signature": {
            "type": "string",
            "description": "HMAC-SHA256 signature"
          },
          "content-type": {
            "type": "string",
            "example": "application/json"
          }
        }
      },
      "JoinRoomEvent": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string"
          },
          "username": {
            "type": "string"
          },
          "roomId": {
            "type": "string"
          },
          "roomOwnerId": {
            "type": "string"
          }
        },
        "example": {
          "userId": "u1",
          "username": "alice",
          "roomId": "r1",
          "roomOwnerId": "u0"
        }
      },
      "CodeChangeEvent": {
        "type": "object",
        "properties": {
          "roomId": {
            "type": "string"
          },
          "code": {
            "type": "string"
          }
        },
        "example": {
          "roomId": "r1",
          "code": "function add(a,b){return a+b}"
        }
      },
      "CursorMoveEvent": {
        "type": "object",
        "properties": {
          "roomId": {
            "type": "string"
          },
          "userId": {
            "type": "string"
          },
          "cursor": {
            "type": "object"
          }
        },
        "example": {
          "roomId": "r1",
          "userId": "u1",
          "cursor": {
            "line": 10,
            "ch": 2
          }
        }
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Authentication related endpoints"
    },
    {
      "name": "User",
      "description": "User management and profile operations"
    },
    {
      "name": "Role",
      "description": "Role-based access management"
    },
    {
      "name": "Permission",
      "description": "Permission configuration APIs"
    },
    {
      "name": "Room",
      "description": "Room management for collaboration"
    },
    {
      "name": "File",
      "description": "File and snapshot management"
    },
    {
      "name": "Execution",
      "description": "Code execution endpoints"
    },
    {
      "name": "Analytics",
      "description": "Usage and system analytics"
    },
    {
      "name": "Billing",
      "description": "Razorpay billing and subscription APIs"
    },
    {
      "name": "Notification",
      "description": "User notifications and alerts"
    },
    {
      "name": "Admin",
      "description": "Administrative and moderation operations"
    },
    {
      "name": "WebSockets",
      "description": "Real-time events (Socket.IO)"
    },
    {
      "name": "Webhooks",
      "description": "Webhook endpoints and integrations"
    }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "summary": "Register a new user",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthRegisterRequest"
              },
              "example": {
                "name": "Rohan Parmar",
                "email": "rohan@example.com",
                "password": "StrongPass@123"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Login",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthLoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TokenResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid credentials",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/forgot-password": {
      "post": {
        "summary": "Send password reset link",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "alice@example.com"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Email sent",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/reset-password": {
      "post": {
        "summary": "Reset password using token",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "token",
                  "password"
                ],
                "properties": {
                  "token": {
                    "type": "string",
                    "example": "<reset-token>"
                  },
                  "password": {
                    "type": "string",
                    "example": "NewStrong@123"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/refresh-token": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Refresh access token",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "example": "<refresh-token>"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TokenResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/profile": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "Get current user profile",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Profile"
          }
        }
      },
      "put": {
        "tags": [
          "User"
        ],
        "summary": "Update current user profile",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UserProfile"
              },
              "example": {
                "name": "Alice"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/{id}/rooms": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "Get rooms for a user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Rooms"
          }
        }
      }
    },
    "/users": {
      "get": {
        "tags": [
          "User"
        ],
        "summary": "List users (admin)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Users list"
          }
        }
      }
    },
    "/users/assign-role": {
      "post": {
        "tags": [
          "User"
        ],
        "summary": "Assign role to user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "userId",
                  "roleId"
                ],
                "properties": {
                  "userId": {
                    "type": "string",
                    "example": "user_123"
                  },
                  "roleId": {
                    "type": "string",
                    "example": "role_admin"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Role assigned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/roles": {
      "post": {
        "tags": [
          "Role"
        ],
        "summary": "Create role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "example": "moderator"
                  },
                  "description": {
                    "type": "string",
                    "example": "Can moderate rooms"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Role"
        ],
        "summary": "Get all roles",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of roles"
          }
        }
      }
    },
    "/roles/assign-permission": {
      "post": {
        "tags": [
          "Role"
        ],
        "summary": "Assign permission to role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "roleId",
                  "permissionId"
                ],
                "properties": {
                  "roleId": {
                    "type": "string",
                    "example": "role_moderator"
                  },
                  "permissionId": {
                    "type": "string",
                    "example": "perm_rooms_update"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Assigned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/roles/set-parent": {
      "post": {
        "tags": [
          "Role"
        ],
        "summary": "Set role parent",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "childRoleId",
                  "parentRoleId"
                ],
                "properties": {
                  "childRoleId": {
                    "type": "string",
                    "example": "role_moderator"
                  },
                  "parentRoleId": {
                    "type": "string",
                    "example": "role_admin"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/roles/hierarchy": {
      "get": {
        "tags": [
          "Role"
        ],
        "summary": "Get role hierarchy",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Hierarchy"
          }
        }
      }
    },
    "/permissions": {
      "get": {
        "tags": [
          "Permission"
        ],
        "summary": "List permissions",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      },
      "post": {
        "tags": [
          "Permission"
        ],
        "summary": "Create permission",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "action",
                  "resource"
                ],
                "properties": {
                  "action": {
                    "type": "string",
                    "example": "update"
                  },
                  "resource": {
                    "type": "string",
                    "example": "rooms"
                  },
                  "description": {
                    "type": "string",
                    "example": "Update rooms"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/permissions/{id}": {
      "delete": {
        "tags": [
          "Permission"
        ],
        "summary": "Delete permission",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted"
          }
        }
      }
    },
    "/rooms": {
      "post": {
        "tags": [
          "Room"
        ],
        "summary": "Create room",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RoomCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Room"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "Room"
        ],
        "summary": "List rooms",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      }
    },
    "/rooms/{id}": {
      "get": {
        "tags": [
          "Room"
        ],
        "summary": "Get room by ID",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Room"
          }
        }
      },
      "delete": {
        "tags": [
          "Room"
        ],
        "summary": "Delete room",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted"
          }
        }
      }
    },
    "/rooms/join": {
      "post": {
        "tags": [
          "Room"
        ],
        "summary": "Join room",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JoinRoomRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Joined",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/rooms/leave": {
      "post": {
        "tags": [
          "Room"
        ],
        "summary": "Leave room",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JoinRoomRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Left",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/execution/execute": {
      "post": {
        "tags": [
          "Execution"
        ],
        "summary": "Queue code execution",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ExecutionRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Queued",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "jobId": {
                      "type": "string"
                    },
                    "executionId": {
                      "type": "string"
                    },
                    "status": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/execution": {
      "get": {
        "tags": [
          "Execution"
        ],
        "summary": "List executions",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      }
    },
    "/execution/{id}": {
      "get": {
        "tags": [
          "Execution"
        ],
        "summary": "Get execution by ID",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Execution"
          }
        }
      }
    },
    "/billing/create": {
      "post": {
        "tags": [
          "Billing"
        ],
        "summary": "Create subscription",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BillingCreateRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Subscription"
                }
              }
            }
          }
        }
      }
    },
    "/billing/verify": {
      "post": {
        "tags": [
          "Billing"
        ],
        "summary": "Verify payment signature",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/BillingVerifyRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Activated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Subscription"
                }
              }
            }
          }
        }
      }
    },
    "/billing/active": {
      "get": {
        "tags": [
          "Billing"
        ],
        "summary": "Get active subscription",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Current subscription"
          }
        }
      }
    },
    "/notifications": {
      "get": {
        "tags": [
          "Notification"
        ],
        "summary": "Get my notifications",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      }
    },
    "/notifications/{id}/read": {
      "patch": {
        "tags": [
          "Notification"
        ],
        "summary": "Mark notification as read",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Notification"
                }
              }
            }
          }
        }
      }
    },
    "/notifications/clear": {
      "delete": {
        "tags": [
          "Notification"
        ],
        "summary": "Clear all notifications",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Cleared"
          }
        }
      }
    },
    "/files/rooms/{roomId}/files": {
      "post": {
        "tags": [
          "File"
        ],
        "summary": "Create file in a room",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "roomId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FileCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/File"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "File"
        ],
        "summary": "List files in a room",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "roomId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      }
    },
    "/files/{id}": {
      "get": {
        "tags": [
          "File"
        ],
        "summary": "Get file by ID",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "File"
          }
        }
      },
      "put": {
        "tags": [
          "File"
        ],
        "summary": "Update file",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/FileCreate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/File"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "File"
        ],
        "summary": "Delete file",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted"
          }
        }
      }
    },
    "/files/{id}/snapshots": {
      "post": {
        "tags": [
          "File"
        ],
        "summary": "Create snapshot for a file",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SnapshotCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": [
          "File"
        ],
        "summary": "List snapshots for a file",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List"
          }
        }
      }
    },
    "/admin/users": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List all users (admin)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Users"
          }
        }
      }
    },
    "/admin/rooms": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List all rooms (admin)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Rooms"
          }
        }
      }
    },
    "/auth/oauth/{provider}/url": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "Get OAuth URL for provider (google|github)",
        "parameters": [
          {
            "in": "path",
            "name": "provider",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "google",
                "github"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "URL"
          }
        }
      }
    },
    "/auth/oauth/{provider}/callback": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "OAuth callback for provider",
        "parameters": [
          {
            "in": "path",
            "name": "provider",
            "required": true,
            "schema": {
              "type": "string",
              "enum": [
                "google",
                "github"
              ]
            }
          },
          {
            "in": "query",
            "name": "code",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Tokens and user"
          }
        }
      }
    },
    "/chat/{roomId}": {
      "get": {
        "tags": [
          "Room"
        ],
        "summary": "Get chat messages for room",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "roomId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Messages"
          }
        }
      }
    },
    "/admin/executions": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List recent executions",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Executions"
          }
        }
      }
    },
    "/admin/metrics": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "System metrics summary",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Metrics"
          }
        }
      }
    },
    "/admin/roles": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List roles",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Roles"
          }
        }
      },
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Create role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "isDefault": {
                    "type": "boolean"
                  },
                  "parentRoleId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/admin/roles/{id}/permissions": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Assign permissions to role",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "permissions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "action": {
                          "type": "string"
                        },
                        "resource": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/admin/users/{id}/role": {
      "post": {
        "tags": [
          "Admin"
        ],
        "summary": "Assign role to user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "roleId"
                ],
                "properties": {
                  "roleId": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/admin/subscriptions": {
      "get": {
        "tags": [
          "Admin"
        ],
        "summary": "List all subscriptions (admin)",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Subscriptions"
          }
        }
      }
    },
    "/webhooks": {
      "get": {
        "summary": "Webhooks Reference",
        "description": "This project currently does not expose public webhook endpoints.\nBilling uses direct Razorpay signature verification via REST (no webhook handler).\n\nIf you later add webhooks (e.g., /billing/webhook, /github/webhook), document them here.\n",
        "tags": [
          "Webhooks"
        ]
      }
    },
    "/websockets": {
      "get": {
        "summary": "WebSocket Event Reference",
        "description": "This page documents all **real-time Socket.IO events** used in CodeCollab.\n\n---\n###  Collaboration Events\n\nEvent: `join-room`\n- Payload schema: `JoinRoomEvent`\n- Example:\n```json\n{ \"userId\": \"u1\", \"username\": \"alice\", \"roomId\": \"r1\", \"roomOwnerId\": \"u0\" }\n```\n- Emits: `presence-update`  `string[]` of usernames in room\n\nEvent: `leave-room`\n- Payload schema: `JoinRoomEvent`\n- Example:\n```json\n{ \"userId\": \"u1\", \"username\": \"alice\", \"roomId\": \"r1\" }\n```\n- Emits: `presence-update`  `string[]`\n\nEvent: `code-change`\n- Payload schema: `CodeChangeEvent`\n- Example:\n```json\n{ \"roomId\": \"r1\", \"code\": \"function add(a,b){return a+b}\" }\n```\n- Emits: `code-update`  `{ \"code\": string }`\n\nEvent: `cursor-move`\n- Throttled to 100ms per client\n- Payload schema: `CursorMoveEvent`\n- Example:\n```json\n{ \"roomId\": \"r1\", \"userId\": \"u1\", \"cursor\": { \"line\": 10, \"ch\": 2 } }\n```\n- Emits: `cursor-update`  `{ \"userId\": string, \"cursor\": object }`\n\nEvent: `user-reconnect`\n- Payload schema: `JoinRoomEvent`\n- Emits: `presence-update`  `string[]`\n\n---\n###  Notification Events\nNotifications are emitted server-side on certain actions (e.g., room join).\n- Emits: `new-notification`  `Notification`\n\n---\n###  Execution Events\nReal-time execution updates may be emitted as `execution-result` to room namespaces.\n",
        "tags": [
          "WebSockets"
        ]
      }
    }
  }
}